<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="l10n_sv_report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//t[@t-set='o']" position="after">
            <t t-set="is_l10n_sv_invoice"
               t-value="o.l10n_sv_fiscal_journal and o.company_id.country_id and o.company_id.country_code in ['SV']"/>
        </xpath>

        <!-- Hide when l10n_sv_invoice -->
        <xpath expr="//div[hasclass('page')]/t[@t-set='layout_document_title']" position="attributes">
            <attribute name="t-if">not is_l10n_sv_invoice</attribute>
        </xpath>
        <xpath expr="///div[hasclass('page')]//div[@id='payment_term']//p[@name='payment_communication']" position="attributes">
            <attribute name="t-if">not is_l10n_sv_invoice</attribute>
        </xpath>
        <xpath expr="//div[hasclass('row')]" position="attributes">
            <attribute name="t-if">not is_l10n_sv_invoice</attribute>
        </xpath>

        <xpath expr="//div[hasclass('row')]" position="before">
            <div class="row" t-if="is_l10n_sv_invoice">
                <div id="sv_informations" class="col-7 mt36 mb32 mr8">

                    <!-- Fiscal info -->
                    <div class="col-12">
                        <h3>
                            <t t-if="o.state == 'draft'">
                                Borrador
                                <br/>
                            </t>
                            <t t-if="o.state == 'cancel'">
                                Anulada
                                <br/>
                            </t>
                            <span t-field="o.l10n_sv_voucher_type_id.name"/>
                            <br/>
                            <span t-if="o.name" style="font-size:22px; !important;margin:0px;padding:0px 0px;">
                                <strong>
                                    <span t-if="o.name != '/'" t-field="o.name"/>
                                </strong>
                            </span>
                        </h3>
                        <div t-if="o.l10_sv_dte_id.l10n_sv_generation_code" name="generation_code">
                            <strong>Generation Code:</strong>
                            <p class="m-0" t-field="o.l10_sv_dte_id.l10n_sv_generation_code"/>
                        </div>
                        <div t-if="o.l10_sv_dte_id.name" name="control_numer">
                            <strong>Control Number:</strong>
                            <p class="m-0" t-field="o.l10_sv_dte_id.name"/>
                        </div>
                        <div t-if="o.l10_sv_dte_id.l10n_sv_receipt_stamp" name="receipt_stamp">
                            <strong>Receipt Stamp:</strong>
                            <p class="m-0" t-field="o.l10_sv_dte_id.l10n_sv_receipt_stamp"/>
                        </div>
                    </div>
                </div>
                <div class="col-5">
                    <!--            Identification info-->
                    <div name="l10n_sv_billing_model" t-if="is_l10n_sv_invoice">
                        <strong>Billing model:</strong>
                        <span class="m-0" t-out="'Previo'"/>
                    </div>
                    <div name="l10n_sv_transmission_type" t-if="is_l10n_sv_invoice">
                        <strong>Transmission type:</strong>
                        <span class="m-0" t-field="o.l10n_sv_dte_situation"/>
                    </div>
                    <div name="l10n_date_generation" t-if="is_l10n_sv_invoice and o.l10_sv_dte_id">
                        <strong>Generation Date and Time:</strong>
                        <p class="m-0" t-field="o.l10_sv_dte_id.date_issue"/>
                    </div>

                    <t t-if="is_l10n_sv_invoice and (o.move_type == 'out_refund' or o.move_type == 'in_refund' or o.debit_origin_id)">
                    <div name="l10n_sv_generation_code_origin" t-if="o.l10n_sv_generation_code_ref">
                        <strong>Código de generación de referencia:</strong>
                        <p class="m-0" t-field="o.l10n_sv_generation_code_ref"/>
                    </div>
                    <div name="l10n_sv_generation_code_origin" t-if="o.debit_origin_id.l10_sv_dte_id.l10n_sv_generation_code">
                        <strong>Código de generación de referencia:</strong>
                        <p class="m-0" t-field="o.debit_origin_id.l10_sv_dte_id.l10n_sv_generation_code"/>
                    </div>
                    <div name="l10n_sv_generation_code_origin" t-if="o.l10n_sv_date_issue_ref">
                        <strong>Fecha de referencia:</strong>
                        <p class="m-0" t-field="o.l10n_sv_date_issue_ref"/>
                    </div>
                    </t>
                </div>
            </div>

            <div class="row" t-if="is_l10n_sv_invoice">
                <div id="sv_informations2" class="col-7 mt36 mb32 mr8">

                    <!-- Company info -->
                    <address>
                        <span t-if="o.company_id.name" style="color:#111 !important;">Nombre o razón social:
                            <t t-esc="o.company_id.name"/>
                            <br/>
                        </span>
                        <span t-if="o.company_id.partner_id.nit" style="color:#111 !important;">NIT:
                            <t t-esc="o.company_id.partner_id.nit"/>
                            <br/>
                        </span>
                        <span t-if="o.company_id.partner_id.vat" style="color:#111 !important;">NRC:
                            <t t-esc="o.company_id.partner_id.vat"/>
                            <br/>
                        </span>
                        <span t-if="o.company_id.l10n_sv_economic_activity_ids" style="color:#111 !important;">Actividad económica:
                            <t t-esc="o.company_id.l10n_sv_economic_activity_ids[0].name"/>
                            <br/>
                        </span>
                        <span t-if="o.company_id.street" style="color:#111 !important;">
                            <t t-esc="o.company_id.street"/>
                            <br/>
                        </span>
                        <span t-if="o.company_id.email" style="color:#111 !important;">
                            <i class="fa fa-envelope"/>
                            <t t-esc="o.company_id.email"/>
                            <br/>
                        </span>
                        <span t-if="o.company_id.partner_id.l10n_sv_commercial_name" style="color:#111 !important;">Nombre comercial:
                            <t t-esc="o.company_id.partner_id.l10n_sv_commercial_name"/>
                            <br/>
                        </span>
                        <span style="color:#111 !important;">Tipo de establecimiento:
                            <span t-field="o.company_id.l10n_sv_establishment_type"/>
                        </span>
                    </address>
                </div>
                <div class="col-5">
                    <!-- Customer info -->
                    <div name="no_shipping">
                        <address>
                            <span style="color:#111 !important;" t-field="o.partner_id"/>
                            <br/>
                            <span t-if="o.partner_id.nit" style="color:#111 !important;">NIT:
                                <t t-esc="o.partner_id.nit"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.vat" style="color:#111 !important;">RNC:
                                <t t-esc="o.partner_id.vat"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.phone" style="color:#111 !important;">
                                <i class="fa fa-phone"/>
                                <t t-esc="o.partner_id.phone"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.mobile" style="color:#111 !important;">
                                <i class="fa fa-mobile"/>
                                <t t-esc="o.partner_id.mobile"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.email" style="color:#111 !important;">
                                <i class="fa fa-envelope"/>
                                <t t-esc="o.partner_id.email"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.street" style="color:#111 !important;"><t
                                    t-esc="o.partner_id.street"/>,
                            </span>
                            <span t-if="o.partner_id.street2" style="color:#111 !important;"><t
                                    t-esc="o.partner_id.street2"/>.
                                <br/>
                            </span>
                            <span t-if="o.partner_id.city" style="color:#111 !important;">
                                <t t-esc="o.partner_id.city"/>
                                ,
                            </span>
                            <span t-if="o.partner_id.country_id.name" style="color:#111 !important;">
                                <t t-esc="o.partner_id.country_id.name"/>
                            </span>
                            <br/>
                            <span t-if="o.partner_id.l10n_sv_commercial_name" style="color:#111 !important;">Nombre comercial:
                                <t t-esc="o.partner_id.l10n_sv_commercial_name"/>
                                <br/>
                            </span>
                        </address>
                    </div>
                    <div name="shipping_address_block" groups="account.group_delivery_invoice_address">
                        <strong>Dirección de entrega:</strong>
                        <p t-field="o.partner_shipping_id.name">Shipping Name</p>
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@id='informations']" position="inside">
<!--            <div t-attf-class="#{'col-auto col-3 mw-100' if report_type != 'html' else 'col'} mb-2"-->
<!--                 t-if="o.currency_id and is_l10n_cr_invoice" name="currency">-->
<!--                <strong>Moneda:</strong>-->
<!--                <br/>-->
<!--                <p class="m-0" t-esc="o.currency_id.name"/>-->
<!--                <t t-set="display_exchange" t-value="o.currency_id.name != 'CRC'"/>-->
<!--                <t t-if="display_exchange">-->
<!--                    (<span t-field="o.currency_rate"-->
<!--                           t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>)-->
<!--                </t>-->
<!--            </div>-->
        </xpath>
        <xpath expr="//div[@id='qrcode']" position="after">
            <div t-if="is_l10n_sv_invoice">
                <div>
                    <img t-if="o.l10n_sv_qr_code" t-att-src="image_data_uri(o.l10n_sv_qr_code)" alt="Logo"
                         width="150" height="150" class="media-object"/>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@id='right-elements']/.." position="inside">
            <t t-if="is_l10n_sv_invoice">
<!--                Summary info-->
                <div t-if="o.move_type in ('out_invoice', 'in_refund') and o.l10_sv_dte_id">
                    <span name="amount_total_words">
                        Valor en letras: <span class="fw-bold" t-field="o.amount_total_words">INV/2023/00001</span>
                    </span>
                </div>
                <div t-if="o.move_type in ('out_invoice', 'in_refund') and o.l10_sv_dte_id">
                    <span name="payment_communication">
                        Condición de la operación: <span class="fw-bold" t-out="'Contado' if o.l10_sv_dte_id.get_payment_type() == 1 else 'Crédito'">INV/2023/00001</span>
                    </span>
                </div>
                <div class="mt-2" name="l10n_sv_quantity_lines">
                    <div>CANT. ARTICULO (S):
                        <t t-esc="len(lines)"/>
                    </div>
                </div>
            </t>
        </xpath>
<!--        <xpath expr="//div[@id='right-elements']/div/div/table[hasclass('o_total_table')]/t" position="before">-->
<!--            <tr t-if="display_discount">-->
<!--                <td>Total Discount</td>-->
<!--                <td class="text-end">-->
<!--                    <span t-field="o.amount_discount"-->
<!--                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>-->
<!--                </td>-->
<!--            </tr>-->
<!--        </xpath>-->
    </template>
</odoo>
